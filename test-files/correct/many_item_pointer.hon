# many-item pointer arithmetic over contiguous struct fields
# main returns 0 on success

Buf :: c struct { a: i32, b: i32, c: i32 }

read_at :: func(base: *i32, offset: i32) i32 {
    p: *i32 = base + offset
    return p^
}

main :: func() i32 {
    mut buf := Buf{ .a = 10, .b = 20, .c = 30 }

    # many-item pointer to first field
    p: *mut i32 = &buf.a

    # ptr + int
    q: *i32 = p + 1
    if q^ != 20 { return 1 }

    # int + ptr (commutative)
    r: *i32 = 2 + p
    if r^ != 30 { return 2 }

    # ptr - int
    s: *i32 = r - 2
    if s^ != 10 { return 3 }

    # many-item pointer passed to function
    result := read_at(p, 2)
    if result != 30 { return 4 }

    return 0
}
